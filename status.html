<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Lumivair — Status</title>
  <link rel="icon" href="/source/Lumivair32x.png" type="image/png">

  <style>
    body{
      font-family:system-ui,Segoe UI,Roboto,Arial;
      margin:0;
      background:#f5f5f7;
      display:flex;
      flex-direction:column;
      min-height:100vh;
    }

    .page-content{
      flex:1;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:20px;
    }

    .card{
      padding:28px 36px;
      border-radius:12px;
      background:#fff;
      box-shadow:0 6px 24px rgba(0,0,0,0.08);
      text-align:center
    }

    .status{font-size:28px;margin-top:8px}
    .online{color:green}
    .offline{color:#d00}
    .muted{color:#666;font-size:14px}
  </style>

  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>

  <div data-include="header.html"></div>

  <div class="page-content">
    <div class="card">
      <h1>Minecraft server</h1>
      <div id="status" class="status muted">Checking…</div>
      <div id="detail" class="muted" style="margin-top:8px">—</div>
    </div>
  </div>

  <div data-include="footer.html"></div>


  <script>
  const endpoint = "https://status.lumivair.space/status";
  const statusEl = document.getElementById('status');
  const detailEl = document.getElementById('detail');

  async function fetchWithTimeout(resource, options = {}){
    const { timeout = 3000 } = options;
    const controller = new AbortController();
    const id = setTimeout(() => controller.abort(), timeout);
    try{
      const response = await fetch(resource, { ...options, signal: controller.signal });
      clearTimeout(id);
      return response;
    }catch(err){
      clearTimeout(id);
      throw err;
    }
  }

  async function check(){
    try{
      const res = await fetchWithTimeout(endpoint, { timeout: 3000 });
      if(!res.ok){
        statusEl.textContent = 'Disconnected';
        statusEl.className = 'status offline';
        detailEl.textContent = 'Backend returned HTTP ' + res.status + ' — treating as disconnected';
        return;
      }
      const data = await res.json();
      if(data && data.active === true){
        statusEl.textContent = 'Server online';
        statusEl.className = 'status online';
        detailEl.textContent = 'Checked at ' + new Date(data.timestamp * 1000).toLocaleString();
      } else {
        statusEl.textContent = 'Disconnected';
        statusEl.className = 'status offline';
        detailEl.textContent = 'Service not active according to backend';
      }
    }catch(err){
      statusEl.textContent = 'Disconnected';
      statusEl.className = 'status offline';
      detailEl.textContent = 'Could not reach backend';
    }
  }

  check();
  setInterval(check, 5000);
  </script>

  <script>
  (async function(){
      // 1. Helper function to fetch content
      async function include(el) {
          const file = el.getAttribute("data-include");
          if (!file) return;
          try {
              const res = await fetch(file);
              el.innerHTML = await res.text();
          } catch (e) {
              el.innerHTML = "";
          }
      }

      // 2. Select all include elements
      const elements = document.querySelectorAll("[data-include]");

      // 3. Wait for ALL HTML includes (header/footer) to finish loading
      await Promise.all(Array.from(elements).map(include));

      // 4. Now that HTML is injected, load the scripts.js file
      const script = document.createElement('script');
      script.src = 'scripts.js';
      document.body.appendChild(script);
  })();
  </script>

</body>
</html>